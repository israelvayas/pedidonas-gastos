<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Balance General</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<style>
:root {
  --bg: #f8f9fa; --card: #fff; --text:#212529;
  --primary:#6c5ce7; --success:#00b894; --danger:#d63031;
}
body.dark { --bg:#181a1b; --card:#242526; --text:#e4e6eb; }
body {font-family:'Segoe UI',Arial,sans-serif; background:var(--bg); color:var(--text); margin:0; padding:0;}
header{background:var(--primary); color:#fff; padding:1rem; text-align:center; position:relative; font-size:1.5rem;}
header button{position:absolute; right:1rem; top:1rem; padding:.3rem .6rem; border:none; border-radius:5px; background:#fff; color:var(--primary); cursor:pointer;}
.container{max-width:1000px;margin:auto;padding:1rem;}
.tabs{display:flex; justify-content:center; margin-bottom:1rem; gap:.5rem; flex-wrap:wrap;}
.tabs button{padding:.5rem 1rem; border:none;border-radius:5px; cursor:pointer;background:var(--primary);color:#fff; font-weight:bold;}
.section{display:none;}
.section.active{display:block;}
form{background:var(--card); padding:1rem; border-radius:10px; margin-bottom:1rem; display:flex; gap:.5rem; flex-wrap:wrap; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
form input, form button{padding:.5rem; border-radius:5px; border:1px solid #ccc; font-size:1rem;}
table{width:100%; border-collapse:collapse; background:var(--card); margin-top:1rem; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
th, td{border:1px solid #eee; padding:.5rem; text-align:center;}
tr.pagado{opacity:0.5;}
.totales, .balance{display:flex; gap:1rem; margin:1rem 0; flex-wrap:wrap;}
.card{flex:1; padding:1rem; border-radius:10px; background:var(--card); text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.success{color:var(--success);}
.danger{color:var(--danger);}
.info{color:var(--primary);}
.search-box{margin:.5rem 0; text-align:right;}
.search-box input{padding:.4rem; border-radius:5px; border:1px solid #ccc;}
button.btn{padding:.4rem .7rem; margin:0 2px; border:none; border-radius:5px; cursor:pointer; font-weight:bold;}
.btn-listo{background:var(--success); color:#fff;}
.btn-eliminar{background:var(--danger); color:#fff;}
</style>
</head>
<body>
<header>Balance General<button onclick="toggleDarkMode()">üåô/‚òÄÔ∏è</button></header>
<div class="container">
<div class="tabs">
<button onclick="mostrar('pedidos')">Pedidos</button>
<button onclick="mostrar('gastos')">Gastos</button>
<button onclick="mostrar('balance')">Balance</button>
</div>

<!-- Pedidos -->
<div id="pedidos" class="section active">
<form id="pedidoForm">
<input type="text" id="cliente" placeholder="Cliente" required>
<input type="text" id="producto" placeholder="Producto" required>
<input type="number" id="cantidad" placeholder="Cantidad" min="1" required>
<input type="number" id="precio" placeholder="Precio" min="0" step="0.01" required>
<button type="submit">‚ûï Agregar</button>
</form>
<div class="totales"><div class="card success">Ingresos: $<span id="totalIngresos">0</span></div></div>
<div class="search-box"><input type="text" id="searchPedidos" placeholder="Buscar pedido..."></div>
<table>
<thead><tr><th>Cliente</th><th>Producto</th><th>Cantidad</th><th>Total</th><th>Fecha</th><th>Acciones</th></tr></thead>
<tbody id="listaPedidos"></tbody>
</table>
</div>

<!-- Gastos -->
<div id="gastos" class="section">
<form id="gastoForm">
<input type="text" id="concepto" placeholder="Concepto" required>
<input type="number" id="monto" placeholder="Monto" min="0" step="0.01" required>
<button type="submit">‚ûï Agregar</button>
</form>
<div class="totales"><div class="card danger">Gastos: $<span id="totalGastado">0</span></div></div>
<div class="search-box"><input type="text" id="searchGastos" placeholder="Buscar gasto..."></div>
<table>
<thead><tr><th>Concepto</th><th>Monto</th><th>Fecha</th><th>Acciones</th></tr></thead>
<tbody id="listaGastos"></tbody>
</table>
</div>

<!-- Balance -->
<div id="balance" class="section">
<div class="balance">
<div class="card success">Total Ingresos: $<span id="balanceIngresos">0</span></div>
<div class="card danger">Total Gastos: $<span id="balanceGastos">0</span></div>
<div class="card info">Ganancia/P√©rdida: $<span id="balanceResultado">0</span></div>
</div>
<div class="totales">
<button onclick="exportarExcel()">‚¨á Exportar Excel</button>
<button onclick="exportarPDF()">‚¨á Exportar PDF</button>
</div>
</div>

<script>
let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
let gastos=JSON.parse(localStorage.getItem("gastos"))||[];

function mostrar(id){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id==="balance") actualizarBalance();
}
function toggleDarkMode(){ document.body.classList.toggle("dark"); }

// Pedidos
function renderPedidos(){
listaPedidos.innerHTML="";
let total=0;
pedidos.forEach((p,i)=>{
total+=p.cantidad*p.precio;
let clase=p.listo?"class='pagado'":"";
listaPedidos.innerHTML+=`<tr ${clase}>
<td>${p.cliente}</td>
<td>${p.producto}</td>
<td>${p.cantidad}</td>
<td>$${(p.cantidad*p.precio).toFixed(2)}</td>
<td>${p.fecha}</td>
<td>
<button class="btn btn-listo" onclick="toggleListo(${i})">
${p.listo ? "‚úî Hecho" : "‚úî Listo"}
</button>
<button class="btn btn-eliminar" onclick="eliminarPedido(${i})">üóë</button>
</td>
</tr>`;
});
totalIngresos.textContent=total.toFixed(2);
}

function toggleListo(i){
pedidos[i].listo = !pedidos[i].listo; // alterna true/false
localStorage.setItem("pedidos", JSON.stringify(pedidos));
renderPedidos();
}

function eliminarPedido(i){ pedidos.splice(i,1); localStorage.setItem("pedidos",JSON.stringify(pedidos)); renderPedidos(); }

document.getElementById("pedidoForm").addEventListener("submit",e=>{
e.preventDefault();
let pedido={cliente:cliente.value,producto:producto.value,cantidad:+cantidad.value,precio:+precio.value,fecha:new Date().toLocaleDateString(),listo:false};
pedidos.push(pedido);
localStorage.setItem("pedidos",JSON.stringify(pedidos));
e.target.reset();
renderPedidos();
});

// Gastos
function renderGastos(){
listaGastos.innerHTML="";
let total=0;
gastos.forEach((g,i)=>{
total+=g.monto;
listaGastos.innerHTML+=`<tr>
<td>${g.concepto}</td><td>$${g.monto.toFixed(2)}</td><td>${g.fecha}</td>
<td><button class="btn btn-eliminar" onclick="eliminarGasto(${i})">üóë</button></td>
</tr>`;
});
totalGastado.textContent=total.toFixed(2);
}

function eliminarGasto(i){ gastos.splice(i,1); localStorage.setItem("gastos",JSON.stringify(gastos)); renderGastos(); }

document.getElementById("gastoForm").addEventListener("submit",e=>{
e.preventDefault();
let gasto={concepto:concepto.value,monto:+monto.value,fecha:new Date().toLocaleDateString()};
gastos.push(gasto);
localStorage.setItem("gastos",JSON.stringify(gastos));
e.target.reset();
renderGastos();
});

// Buscadores
searchPedidos.addEventListener("keyup",()=>{let val=searchPedidos.value.toLowerCase();Array.from(listaPedidos.children).forEach(tr=>tr.style.display=tr.innerText.toLowerCase().includes(val)?"":"none");});
searchGastos.addEventListener("keyup",()=>{let val=searchGastos.value.toLowerCase();Array.from(listaGastos.children).forEach(tr=>tr.style.display=tr.innerText.toLowerCase().includes(val)?"":"none");});

// Balance
function actualizarBalance(){
let totalIngresosNum=pedidos.reduce((a,p)=>a+p.cantidad*p.precio,0);
let totalGastosNum=gastos.reduce((a,g)=>a+g.monto,0);
balanceIngresos.textContent=totalIngresosNum.toFixed(2);
balanceGastos.textContent=totalGastosNum.toFixed(2);
balanceResultado.textContent=(totalIngresosNum-totalGastosNum).toFixed(2);
}

// Export Excel
function exportarExcel(){
let wb=XLSX.utils.book_new();
let ws1=XLSX.utils.json_to_sheet(pedidos);
let ws2=XLSX.utils.json_to_sheet(gastos);
XLSX.utils.book_append_sheet(wb,ws1,"Pedidos");
XLSX.utils.book_append_sheet(wb,ws2,"Gastos");
XLSX.writeFile(wb,"balance.xlsx");
}

// Export PDF
function exportarPDF(){
const { jsPDF } = window.jspdf;
let doc=new jsPDF();
doc.text("Balance General",14,20);
doc.autoTable({head:[["Cliente","Producto","Cantidad","Precio","Fecha"]],body:pedidos.map(p=>[p.cliente,p.producto,p.cantidad,p.precio,p.fecha]),startY:30});
doc.autoTable({head:[["Concepto","Monto","Fecha"]],body:gastos.map(g=>[g.concepto,g.monto,g.fecha]),startY:doc.lastAutoTable.finalY+10});
doc.text(`Ganancia/P√©rdida: $${(pedidos.reduce((a,p)=>a+p.cantidad*p.precio,0)-gastos.reduce((a,g)=>a+g.monto,0)).toFixed(2)}`,14,doc.lastAutoTable.finalY+25);
doc.save("balance.pdf");
}

// Inicializar
renderPedidos();
renderGastos();
</script>
</body>
</html>
